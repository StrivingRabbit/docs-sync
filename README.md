# docs-sync

ä¸€ä¸ªæ–‡æ¡£åŒæ­¥å·¥å…·ï¼Œç”¨äºä»å¤šä¸ª Git ä»“åº“æ‹‰å–å†…å®¹å¹¶ç¼–è¯‘åˆ°æœ¬åœ°é¡¹ç›®ä¸­ã€‚

## ç‰¹æ€§

- ğŸ”„ **å¤šæºåŒæ­¥**: ä»å¤šä¸ª Git ä»“åº“æ‹‰å–æ–‡æ¡£
- ğŸ“ **åŒ…å«ç³»ç»Ÿ**: ä½¿ç”¨ `@include` æŒ‡ä»¤å¼•ç”¨å’ŒåŒ…å«å·²åŒæ­¥æºçš„å†…å®¹
- ğŸ¯ **ç«™ç‚¹è¿‡æ»¤**: æ ¹æ®ç«™ç‚¹é…ç½®æœ‰æ¡ä»¶åœ°åŒ…å«/æ’é™¤å†…å®¹
- ğŸ“Š **ä¾èµ–è¿½è¸ª**: ä½¿ç”¨ä¾èµ–å›¾è¿›è¡Œå¢é‡ç¼–è¯‘
- ğŸ‘€ **ç›‘è§†æ¨¡å¼**: å½“æºæ–‡ä»¶æ›´æ”¹æ—¶è‡ªåŠ¨é‡æ–°ç¼–è¯‘
- ğŸ” **é¢„æ¼”æ¨¡å¼**: é¢„è§ˆæ›´æ”¹è€Œä¸å†™å…¥æ–‡ä»¶

## å®‰è£…

```bash
npm install
npm run build
```

## é…ç½®

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `docs-sync.config.ts`ï¼š

```typescript
import { defineConfig } from './src/config';

export default defineConfig({
  site: 'site-a',
  cacheDir: '.docs-sync-cache',

  sources: {
    common: {
      repo: 'git@github.com:your-org/docs-common.git',
      branch: 'main',
    },
  },

  mappings: [
    {
      from: 'common:guides/install.md',
      to: 'docs/guide/install.md',
    },
  ],
});
```

## ä½¿ç”¨

### åŒæ­¥ä¸€æ¬¡

```bash
npm run dev sync
```

### é¢„æ¼”æ¨¡å¼åŒæ­¥ï¼ˆé¢„è§ˆæ›´æ”¹ï¼‰

```bash
npm run dev sync -- --dry-run
```

### ç›‘è§†æ¨¡å¼

```bash
npm run dev watch
```

### è°ƒè¯•æ¨¡å¼

å¯ç”¨è¯¦ç»†æ—¥å¿—è¾“å‡ºï¼š

```bash
npm run dev sync -- --debug
```

### å‘½ä»¤è¡Œé€‰é¡¹

- `--dry-run`: é¢„æ¼”æ¨¡å¼ï¼Œä¸å†™å…¥ä»»ä½•æ–‡ä»¶
- `--debug`: å¯ç”¨è°ƒè¯•æ—¥å¿—ï¼Œæ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ï¼ˆå¦‚å“ˆå¸Œå€¼ã€ä¾èµ–å…³ç³»ç­‰ï¼‰

## æŒ‡ä»¤

### @include

ä»å·²åŒæ­¥çš„æºåŒ…å«å†…å®¹ï¼š

```markdown
<!-- @include common:snippets/warning.md -->
```

### @site

æ ¹æ®ç«™ç‚¹æœ‰æ¡ä»¶åœ°åŒ…å«å†…å®¹ï¼š

```markdown
<!-- @site site-a -->
æ­¤å†…å®¹ä»…å‡ºç°åœ¨ site-a
<!-- @endsite -->

<!-- @site site-b, site-c -->
æ­¤å†…å®¹ä»…å‡ºç°åœ¨ site-b å’Œ site-c
<!-- @endsite -->

<!-- @site !site-a -->
æ­¤å†…å®¹å‡ºç°åœ¨é™¤ site-a å¤–çš„æ‰€æœ‰ç«™ç‚¹
<!-- @endsite -->
```

## é¡¹ç›®ç»“æ„

```
docs-sync/
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ bin/
â”‚   â””â”€â”€ docs-sync.ts        # CLI å…¥å£
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config.ts           # é…ç½®åŠ è½½å™¨
â”‚   â”œâ”€â”€ git.ts              # Git æ“ä½œï¼ˆclone/pullï¼‰
â”‚   â”œâ”€â”€ compiler.ts         # æ–‡ä»¶ç¼–è¯‘
â”‚   â”œâ”€â”€ include.ts          # @include æŒ‡ä»¤
â”‚   â”œâ”€â”€ site-filter.ts      # @site æŒ‡ä»¤
â”‚   â”œâ”€â”€ hash.ts             # å†…å®¹å“ˆå¸Œ
â”‚   â”œâ”€â”€ graph.ts            # ä¾èµ–å›¾
â”‚   â”œâ”€â”€ engine.ts           # sync/watch å‘½ä»¤
â”‚   â”œâ”€â”€ logger.ts           # æ—¥å¿—ç³»ç»Ÿï¼ˆå¸¦é¢œè‰²å’Œæ—¶é—´æˆ³ï¼‰
â”‚   â””â”€â”€ fs/
â”‚       â”œâ”€â”€ types.ts        # æ–‡ä»¶ç³»ç»Ÿæ¥å£
â”‚       â”œâ”€â”€ realFs.ts       # çœŸå®æ–‡ä»¶ç³»ç»Ÿæ“ä½œ
â”‚       â””â”€â”€ dryRunFs.ts     # é¢„æ¼”æ–‡ä»¶ç³»ç»Ÿï¼ˆä»…æ—¥å¿—ï¼‰
â””â”€â”€ docs-sync.config.ts     # ç”¨æˆ·é…ç½®
```

## å·¥ä½œåŸç†

1. **Clone/Pull**: å°†æºä»“åº“åŒæ­¥åˆ°ç¼“å­˜ç›®å½•
2. **ç¼–è¯‘**: å¯¹äºæ¯ä¸ªæ˜ å°„ï¼š
   - è¯»å–æºæ–‡ä»¶
   - å¤„ç† `@include` æŒ‡ä»¤
   - æ ¹æ® `@site` æ ‡ç­¾è¿‡æ»¤å†…å®¹
   - ç”Ÿæˆå“ˆå¸Œç”¨äºå˜æ›´æ£€æµ‹
   - å†™å…¥ç›®æ ‡ä½ç½®
3. **ç›‘è§†**: ç›‘è§†ç¼“å­˜ç›®å½•çš„æ›´æ”¹å¹¶é‡æ–°ç¼–è¯‘å—å½±å“çš„æ–‡ä»¶

## è®¸å¯è¯

MIT
